<div class="search-container container">
  <!-- Search Form -->
  <form (ngSubmit)="onSearch()" class="search-form mb-3">
    <div class="input-group">
      <input
        type="text"
        class="form-control search-input"
        [(ngModel)]="searchTerm"
        name="searchTerm"
        placeholder="Please enter an artist name."
        required
        (focus)="inputFocused = true"
        (blur)="inputFocused = false"
      />
      <button type="submit" class="btn btn-primary" [disabled]="!searchTerm.trim() || loading">Search</button>
      <button type="button" class="btn btn-secondary" (click)="clearSearch()">Clear</button>
    </div>
  </form>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="fullscreen-spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="alert alert-warning">
    {{ errorMessage }}
  </div>

  <!-- Search Results -->
  <div *ngIf="artists?.length" class="horizontal-scroll-container mb-3">
    <div class="horizontal-scroll-content">
      <div
        *ngFor="let artist of artists"
        class="card artist-card me-3 position-relative"
        [class.selected]="artist.id === selectedArtistId"
        (click)="onArtistClick(artist.id)"
      >
        <span
          *ngIf="isLoggedIn"
          class="favorite-icon"
          (click)="toggleFavorite(artist.id, $event)"
          [ngClass]="{ favorited: favoriteArtistIds.has(artist.id) }"
          title="Toggle Favorite"
        >&#9733;</span>

        <img
          [src]="artist.image === 'static/artsy_logo.svg' ? 'assets/artsy_logo.svg' : artist.image"
          class="card-img-top"
          alt="{{ artist.name }}"
        />
        <div class="card-footer text-white text-center">
          <h5 class="card-title m-0 p-2">{{ artist.name }}</h5>
        </div>
      </div>
    </div>
  </div>

  <!-- Artist Details -->
  <div *ngIf="showArtistDetails">
    <div *ngIf="artistLoading" class="fullscreen-spinner">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading artist details...</span>
      </div>
    </div>

    <div *ngIf="!artistLoading && artistDetails" class="artist-details-wrapper">
      <!-- Tabs -->
      <div class="tab-buttons d-flex justify-content-center mb-3">
        <button class="tab-btn" [class.active]="activeTab === 'info'" (click)="switchTab('info')">Artist Info</button>
        <button class="tab-btn" [class.active]="activeTab === 'artworks'" (click)="switchTab('artworks')">Artworks</button>
      </div>

      <!-- Info Tab -->
      <div *ngIf="activeTab === 'info'">
        <h3 class="text-center mb-1">
          {{ artistDetails.name }}
          <span
            *ngIf="isLoggedIn"
            class="favorite-icon-inline"
            (click)="toggleFavorite(artistDetails.id, $event)"
            [ngClass]="{ favorited: favoriteArtistIds.has(artistDetails.id) }"
            title="Toggle Favorite"
          >&#9733;</span>
        </h3>
        <p class="text-center text-muted small">
          {{ artistDetails.nationality }}{{ artistDetails.birthday || artistDetails.deathday ? ', ' : '' }}
          {{ artistDetails.birthday }}{{ artistDetails.deathday ? ' - ' + artistDetails.deathday : '' }}
        </p>
        <div *ngIf="artistDetails.biography">
          <p *ngFor="let paragraph of artistDetails.biography.split('\n')" class="mb-2">
            {{ paragraph }}
          </p>
        </div>
      </div>

      <!-- Artworks Tab -->
      <div *ngIf="activeTab === 'artworks'">
        <div *ngIf="artworksLoading" class="fullscreen-spinner">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading artworks...</span>
          </div>
        </div>

        <div *ngIf="!artworksLoading">
          <div *ngIf="artistDetails.artworks?.length; else noArtworks">
            <div class="artwork-grid">
              <div *ngFor="let artwork of artistDetails.artworks" class="artwork-card card text-center">
                <img
                  [src]="artwork.image === 'static/artsy_logo.svg' ? 'assets/artsy_logo.svg' : artwork.image"
                  class="artwork-img card-img-top"
                  alt="{{ artwork.title }}"
                />
                <div class="card-body px-2 py-2">
                  <p class="artwork-title mb-1">{{ artwork.title }}, {{ artwork.date }}</p>
                  <button class="btn btn-outline-secondary btn-sm" (click)="fetchCategories(artwork.id)">
                    View categories
                  </button>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noArtworks>
            <p class="text-muted text-center">No artworks found for this artist.</p>
          </ng-template>
        </div>
      </div>

      <!-- Similar Artists -->
      <div *ngIf="isLoggedIn && similarArtists.length" class="mt-5">
        <h5 class="text-start mb-3">Similar Artists</h5>
        <div class="similar-artist-grid">
          <div
            *ngFor="let artist of similarArtists.slice(0, 5)"
            class="card similar-artist-card position-relative"
            (click)="onArtistClick(artist.id)"
          >
            <span
              *ngIf="isLoggedIn"
              class="favorite-icon"
              (click)="toggleFavorite(artist.id, $event)"
              [ngClass]="{ favorited: favoriteArtistIds.has(artist.id) }"
              title="Toggle Favorite"
            >&#9733;</span>

            <img
              [src]="artist.image === 'static/artsy_logo.svg' ? 'assets/artsy_logo.svg' : artist.image"
              alt="{{ artist.name }}"
            />
            <div class="card-footer text-white text-center">
              <h5 class="card-title m-0 p-2">{{ artist.name }}</h5>
            </div>
          </div>
        </div>
      </div>
      <!-- End Similar Artists -->
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h5 class="modal-title" id="categoryModalLabel">{{ selectedArtwork?.title }}</h5>
          <p class="text-muted m-0">{{ selectedArtwork?.date }}</p>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div *ngFor="let category of artworkCategories" class="col-6 col-sm-4 col-md-3 mb-3">
            <div class="card h-100">
              <img [src]="category.image" class="card-img-top" alt="{{ category.name }}">
              <div class="card-body text-center py-2">
                <p class="card-text small mb-0">{{ category.name }}</p>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="artworkCategories.length === 0" class="text-center text-muted">No categories found.</div>
      </div>
    </div>
  </div>
</div>